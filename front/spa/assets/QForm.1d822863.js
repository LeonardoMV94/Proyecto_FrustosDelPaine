import{b as M}from"./QTable.fd3fbc3f.js";import{c as j,r as E,a as D,ax as Q,F,ay as R,h as p,g as O,V as B,a9 as A,az as k,aA as H,E as I,b as _,aB as K,v as P,aC as $,aD as z}from"./index.8c963700.js";function S(e,s=new WeakMap){if(Object(e)!==e)return e;if(s.has(e))return s.get(e);const n=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const l=e.valueOf();if(Object(l)!==l){const i=new e.constructor(l);return s.set(e,i),i}}return s.set(e,n),e instanceof Set?e.forEach(l=>{n.add(S(l,s))}):e instanceof Map&&e.forEach((l,i)=>{n.set(i,S(l,s))}),Object.assign(n,...Object.keys(e).map(l=>({[l]:S(e[l],s)})))}var G=j({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:s,emit:n}){const{proxy:l}=O(),{$q:i}=l,c=E(null),a=E(""),r=E("");let b=!1;const h=D(()=>Q({initialValue:a.value,validate:e.validate,set:m,cancel:v,updatePosition:g},"value",()=>r.value,o=>{r.value=o}));function m(){e.validate(r.value)!==!1&&(t()===!0&&(n("save",r.value,a.value),n("update:modelValue",r.value)),f())}function v(){t()===!0&&n("cancel",r.value,a.value),f()}function g(){F(()=>{c.value.updatePosition()})}function t(){return R(r.value,a.value)===!1}function f(){b=!0,c.value.hide()}function y(){b=!1,a.value=S(e.modelValue),r.value=S(e.modelValue),n("beforeShow")}function x(){n("show")}function w(){b===!1&&t()===!0&&(e.autoSave===!0&&e.validate(r.value)===!0?(n("save",r.value,a.value),n("update:modelValue",r.value)):n("cancel",r.value,a.value)),n("beforeHide")}function C(){n("hide")}function u(){const o=s.default!==void 0?[].concat(s.default(h.value)):[];return e.title&&o.unshift(p("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&o.push(p("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[p(B,{flat:!0,color:e.color,label:e.labelCancel||i.lang.label.cancel,onClick:v}),p(B,{flat:!0,color:e.color,label:e.labelSet||i.lang.label.set,onClick:m})])),o}return Object.assign(l,{set:m,cancel:v,show(o){c.value!==null&&c.value.show(o)},hide(o){c.value!==null&&c.value.hide(o)},updatePosition:g}),()=>{if(e.disable!==!0)return p(M,{ref:c,class:"q-popup-edit",cover:e.cover,onBeforeShow:y,onShow:x,onBeforeHide:w,onHide:C,onEscapeKey:v},u)}}}),J=j({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:s,emit:n}){const l=O(),i=E(null);let c=0;const a=[];function r(t){const f=typeof t=="boolean"?t:e.noErrorFocus!==!0,y=++c,x=(u,o)=>{n("validation"+(u===!0?"Success":"Error"),o)},w=u=>{const o=u.validate();return typeof o.then=="function"?o.then(d=>({valid:d,comp:u}),d=>({valid:!1,comp:u,err:d})):Promise.resolve({valid:o,comp:u})};return(e.greedy===!0?Promise.all(a.map(w)).then(u=>u.filter(o=>o.valid!==!0)):a.reduce((u,o)=>u.then(()=>w(o).then(d=>{if(d.valid===!1)return Promise.reject(d)})),Promise.resolve()).catch(u=>[u])).then(u=>{if(u===void 0||u.length===0)return y===c&&x(!0),!0;if(y===c){const{comp:o,err:d}=u[0];if(d!==void 0&&console.error(d),x(!1,o),f===!0){const q=u.find(({comp:V})=>typeof V.focus=="function"&&K(V.$)===!1);q!==void 0&&q.comp.focus()}}return!1})}function b(){c++,a.forEach(t=>{typeof t.resetValidation=="function"&&t.resetValidation()})}function h(t){t!==void 0&&P(t);const f=c+1;r().then(y=>{f===c&&y===!0&&(e.onSubmit!==void 0?n("submit",t):t!==void 0&&t.target!==void 0&&typeof t.target.submit=="function"&&t.target.submit())})}function m(t){t!==void 0&&P(t),n("reset"),F(()=>{b(),e.autofocus===!0&&e.noResetFocus!==!0&&v()})}function v(){$(()=>{if(i.value===null)return;const t=i.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||i.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||i.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(i.value.querySelectorAll("[tabindex]"),f=>f.tabIndex>-1);t!=null&&t.focus({preventScroll:!0})})}A(z,{bindComponent(t){a.push(t)},unbindComponent(t){const f=a.indexOf(t);f>-1&&a.splice(f,1)}});let g=!1;return k(()=>{g=!0}),H(()=>{g===!0&&e.autofocus===!0&&v()}),I(()=>{e.autofocus===!0&&v()}),Object.assign(l.proxy,{validate:r,resetValidation:b,submit:h,reset:m,focus:v,getValidationComponents:()=>a}),()=>p("form",{class:"q-form",ref:i,onSubmit:h,onReset:m},_(s.default))}});export{J as Q,G as a};
