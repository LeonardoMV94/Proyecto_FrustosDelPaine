import{ak as j,J as L,b8 as q,r as n,a as E,E as O,w as R,L as $,X as A,as as d,O as e,N as o,W as y,ar as w,ap as F,Q as k,ao as m,R as s,S as i,V as C,b9 as G}from"./index.3d5788d8.js";import{a as S,Q as J,c as _}from"./QTable.f7cbd520.js";import{Q as W,a as X}from"./QItem.67c78710.js";import{Q as x,a as p}from"./QTr.ac3c5c62.js";import{u as z}from"./productos.ccef6c49.js";import{u as H}from"./ventas.56d0173a.js";import{u as K}from"./clientes.1c6edffe.js";const Y=async()=>(await j.get("/ventas")).data,Z={class:"q-pa-lg"},ee={class:"row"},oe={class:"col"},ae=d("div",{class:"text-h6 col-6"},"Cliente",-1),te={class:"text-weight-bolder"},le={class:"text-h6"},se=d("div",{class:"text-h6"},"Metodos de pago",-1),ne={class:"q-gutter-sm row"},me=L({__name:"pedidoPage",setup(D){const Q=z(),f=H(),T=K(),{productos:I}=q(Q),P=n([]);n([]);const N=l=>new Intl.NumberFormat("es-CL",{currency:"CLP",style:"currency"}).format(l),r=n([]),v=n(),g=n(),V=n(),h=n(),U=n(),B=[{field:"descripcion",name:"descripcion",label:"descripcion"},{field:"peso_gramos",name:"peso_gramos",label:"peso_gramos"},{field:"precio_neto",name:"precio_neto",label:"precio_neto"},{field:"stock",name:"stock",label:"stock"},{field:l=>l.Categorias.categoria,name:"categoria",label:"categoria"}];n();const u=E(()=>r.value.reduce((l,t)=>{const a=t.precio_neto*t.cantidad;return l+a},0)),M=()=>{var b;const l=u.value-u.value*.19,t=r.value.map(c=>({Producto_id:c.id,cantidad:c.cantidad,precio_neto:c.precio_neto,precio_total_neto:c.precio_neto*c.cantidad})),a={neto:u.value,iva:l,total:u.value+l,Clientes_id:(b=v.value)==null?void 0:b.value,Usuarios_id:1,Estado_Pago_id:1,Detalle_venta:[...t]};console.log(a),f.createPedido(a).then(c=>console.log(c))};return O(async()=>{f.getAllMetodosDePage(),Q.getProductos(),T.getClientes().then(l=>h.value=l.map(t=>({value:t.id,label:`${t.nombre} ${t.apellido}`}))),P.value=await Y(),U.value=Object.keys(P.value).map(l=>({field:l,name:l.toUpperCase(),label:l}))}),R(r,(l,t)=>{console.log("productos seleccionados anteriores: ",t),console.log("productos seleccionados nuevos: ",l)}),(l,t)=>($(),A("div",Z,[d("div",ee,[e(S,{class:"col",flat:"",bordered:"",title:"Productos para venta",rows:y(I),columns:B,"no-data-label":"No se encuentran los productos","row-key":"id",filter:g.value,selection:"multiple",selected:r.value,"onUpdate:selected":t[1]||(t[1]=a=>r.value=a)},{"top-right":o(()=>[e(F,{outlined:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value=a),placeholder:"Buscar"},{append:o(()=>[e(k,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter","selected"]),d("div",oe,[e(w,null,{default:o(()=>[e(m,{class:"row justify-center"},{default:o(()=>[ae,e(J,{square:"",class:"col",clearable:"",modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=a=>v.value=a),options:h.value},{prepend:o(()=>[e(k,{name:"person"})]),"no-option":o(()=>[e(W,null,{default:o(()=>[e(X,{class:"text-italic text-grey"},{default:o(()=>[s(" Sin clientes ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),e(S,{class:"",title:"Productos de cliente",rows:r.value,"no-data-label":"sin productos para cliente"},{header:o(()=>[e(x,null,{default:o(()=>[e(_,null,{default:o(()=>[s(" ID ")]),_:1}),e(_,null,{default:o(()=>[s(" Descripcion ")]),_:1}),e(_,null,{default:o(()=>[s(" peso en gramos ")]),_:1}),e(_,null,{default:o(()=>[s(" precio neto ")]),_:1}),e(_,null,{default:o(()=>[s(" cantidad ")]),_:1})]),_:1})]),body:o(a=>[e(x,null,{default:o(()=>[e(p,null,{default:o(()=>[s(i(a.row.id),1)]),_:2},1024),e(p,null,{default:o(()=>[s(i(a.row.descripcion),1)]),_:2},1024),e(p,null,{default:o(()=>[s(i(a.row.peso_gramos),1)]),_:2},1024),e(p,null,{default:o(()=>[s(i(a.row.precio_neto),1)]),_:2},1024),e(p,{class:"row justify-between"},{default:o(()=>[e(C,{color:"red",label:"-",onClick:()=>{a.row.cantidad<=0||a.row.cantidad--}},null,8,["onClick"]),d("div",te,i(a.row.cantidad),1),e(C,{color:"blue",label:"+",onClick:b=>a.row.cantidad++},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["rows"]),e(w,null,{default:o(()=>[e(m,null,{default:o(()=>[d("div",le," Total a pagar "+i(N(u.value)),1)]),_:1})]),_:1}),e(w,{class:""},{default:o(()=>[e(m,null,{default:o(()=>[se]),_:1}),e(m,{class:"row justify-between"},{default:o(()=>[d("div",ne,[e(G,{class:"col",type:"radio",modelValue:V.value,"onUpdate:modelValue":t[3]||(t[3]=a=>V.value=a),options:y(f).metodosDePage},null,8,["modelValue","options"])]),e(C,{color:"blue",onClick:M,label:"Pagar"})]),_:1})]),_:1})])])]))}});export{me as default};
